<div class="contain authentication auth-redesign" [ngClass]="theme">
  <div class="d-flex loading-overlay" *ngIf="loading">
    <div class="loading-overlay-inner">
      <app-common-innerloading-spinner></app-common-innerloading-spinner>
    </div>
  </div>
  <div *ngIf="!loading">
    <div class="page-back" (click)="goBackmain()" *ngIf="step===1 || step===3">
      <i class="fa fa-arrow-left" aria-hidden="true"></i>
      <span>Back</span>
    </div>
    <div class="auth-shell" *ngIf="step===1 || step===3">
      <div class="auth-card">
        <div class="auth-logo" *ngIf="templateConfig?.logo">
          <img [src]="templateConfig.logo" alt="Kanistha logo">
        </div>
        <div class="auth-hero" *ngIf="loginCoverUrl">
          <img [src]="loginCoverUrl" alt="Login cover">
        </div>
        <div class="auth-body" *ngIf="step===1">
          <h1 class="auth-title" id="targeted">Login<span class="auth-title-light"> or <span
                class="auth-title">Signup</span></span></h1>
          <div class="form-group mobile-no">
            <div class="auth-phone">
              <app-phone-input *ngIf="(intlTelInputLoader.ready$ | async)" [(ngModel)]="phoneNumber" name="phoneNumber" [initialCountry]="'in'"
                [preferredCountries]="preferredCountries" [nationalMode]="false"
                (phoneNumberChange)="onPhoneNumberChanged($event)"
                [separateDialCode]="true"></app-phone-input>
              <input *ngIf="!(intlTelInputLoader.ready$ | async)" type="tel" class="form-control"
                placeholder="Enter your mobile number" autocomplete="off" disabled>
            </div>
            <div class="sts-msg error" *ngIf="phoneError">{{phoneError}}</div>
            <div class="form-group email mt-4" *ngIf="phoneNumber && phoneNumber.dialCode != '+91' && !isLogin">
              <label for="phone">Enter your Email</label>
              <input type="text" class="form-control" id="emailId" [(ngModel)]="emailId" autocomplete="off"
                (keypress)="resetApiErrors()">
            </div>
          </div>
          <label class="terms">
            <input type="checkbox" #termsCheck class="terms-checkbox">
            <span>By continuing, I agree to the <a class="terms-link" href="" (click)="openLegalPage('terms', $event)">Terms of Use</a> &amp; <a
                class="terms-link" href="" (click)="openLegalPage('privacy', $event)">Privacy Policy</a></span>
          </label>
          <button id="btnSendOTP" class="cust-logpg-submt mat-button mdc-button continue-button auth-continue"
            type="button"
            [disabled]="api_loading || !termsCheck.checked || (phoneNumber && phoneNumber.number ? phoneNumber.number.length <= 3 : true)"
            (click)="!btnClicked && sendOTP()" (keyup)="clearPhoneExists()">
            <span class="continue" *ngIf="!api_loading">Continue</span>
            <app-common-innerloading-spinner [spinnerParams]="{diameter:30}" *ngIf="api_loading">
            </app-common-innerloading-spinner>
          </button>
        </div>

        <div class="auth-body" *ngIf="step===3">
          <h1 class="auth-title" style="margin-bottom: 2px;">Verify with OTP</h1>
          <p class="auth-subtitle">Sent to
            <span *ngIf="phoneNumber && phoneNumber.dialCode==='+91'">{{phoneNumber.e164Number}}</span>
            <span *ngIf="phoneNumber && phoneNumber.dialCode!=='+91'">{{emailId?emailId: 'email'}}</span>
          </p>

          <div class="otp-container">
            <ng-otp-input class="bkgclr" (onInputChange)="!btnClicked && onOtpChange($event)"
              [config]="config"></ng-otp-input>
          </div>

          <div class="otp-timer-red" *ngIf="resetCounterVal>0">
            Resend OTP in: <span class="timer-text">00:{{resetCounterVal | number:'2.0-0'}}</span>
          </div>
          <p class="otp-resend-link" *ngIf="resetCounterVal==0">
            <span class="pointer-cursor link resent-link" (click)="!btnClicked && sendOTP('resent')">Resend OTP</span>
          </p>

          <button id="btnVerifyOTP" class="cust-logpg-submt mat-button mdc-button continue-button auth-continue"
            type="button" [disabled]="api_loading || !isOtpComplete()" (click)="!btnClicked && verifyOTP()">
            <span class="continue" *ngIf="!api_loading">Verify OTP</span>
            <app-common-innerloading-spinner [spinnerParams]="{diameter:30}" *ngIf="api_loading">
            </app-common-innerloading-spinner>
          </button>
          <div class="auth-help">Have trouble logging in? <a class="terms-link" style="cursor: pointer;" (click)="goBack()">Change Login Method</a>
                </div>
        </div>

        <div class="auth-body-sub">
          <div class="google-wrap" *ngIf="step===1">
            <div id="googleBtn" class="g-container google-button btngle" #googleBtn></div>
          </div>
        </div>
      </div>
    </div>

    <div class="auth-legacy" *ngIf="step!==1 && step!==3">
      <div class="p-4">
        <div *ngIf="step===2" class="text-center">
          <h1>Let's get to know you...</h1>
          <div class="form-group otp">
            <label for="phone">First Name</label>
            <input type="text" class="form-control" id="first_name" [(ngModel)]="firstName" autocomplete="off" />
          </div>
          <div class="form-group otp">
            <label for="phone">Last Name</label>
            <input type="text" class="form-control" id="first_name" [(ngModel)]="lastName" autocomplete="off" />
          </div>
          <div class="form-group otp" *ngIf="googleLogin">
            <label for="phone">Mobile Number</label>
            <div class="mb-3">
              <app-phone-input *ngIf="(intlTelInputLoader.ready$ | async)" [(ngModel)]="phoneNumber" name="phoneNumber" [initialCountry]="'in'"
                [preferredCountries]="preferredCountries" [nationalMode]="false"
                (phoneNumberChange)="onPhoneNumberChanged($event)"
                [separateDialCode]="true"></app-phone-input>
              <input *ngIf="!(intlTelInputLoader.ready$ | async)" type="tel" class="form-control"
                placeholder="Enter your mobile number" autocomplete="off" disabled>
              <div class="sts-msg error" *ngIf="phoneError">{{phoneError}}</div>
            </div>
          </div>
          <div class="form-group otp"
            style="display: flex !important; justify-content: space-between !important;">
            <button id="btnBack" class="mt-4 mat-button mdc-button signup-button" type="button"
              [disabled]="api_loading" (click)="goBack()">
              <span>Back</span>
              <app-common-innerloading-spinner [spinnerParams]="{diameter:30}" *ngIf="api_loading">
              </app-common-innerloading-spinner>
            </button>
            <button id="btnContinue" class="mt-4 mat-button mdc-button signup-button" type="button"
              [disabled]="api_loading" (click)="!btnClicked && signUpConsumer()">
              <span>Next</span>
              <app-common-innerloading-spinner [spinnerParams]="{diameter:30}" *ngIf="api_loading">
              </app-common-innerloading-spinner>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
